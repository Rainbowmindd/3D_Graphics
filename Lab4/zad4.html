<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE-edge" />
    <script src="./x3dom-full.js"></script>
</head>

<body>
    <x3d width="'500px" height="400px">
        <scene>
            <transform translation="0 0.7 0">
                <shape>
                    <appearance>
                        <material id="lightRed" diffuseColor="1 0 0"></material>
                    </appearance>
                    <sphere radius="0.5"></sphere>
                </shape>
            </transform>
            <transform>
                <shape>
                    <appearance>
                        <material id="lightYellow" diffuseColor="1 1 0"></material>
                    </appearance>
                    <sphere radius="0.5"></sphere>
                </shape>
            </transform>
            <transform translation="0 -0.7 0">
                <shape>
                    <appearance>
                        <material id="lightGreen" diffuseColor="0 1 0"></material>
                    </appearance>
                    <sphere radius="0.5"></sphere>
                </shape>
            </transform>
        </scene>
    </x3d>
    <script>
       <!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Kółko i krzyżyk (X3DOM) - Twilight vs Spike</title>
  <script src="./x3dom-full.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 10px;
    }
    #ui {
      margin: 10px auto;
      width: 900px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    #status { font-size: 18px; }
    button { padding: 8px 14px; font-size: 16px; }
  </style>
</head>

<body>
  <h2>Kółko i krzyżyk — Twilight (O) vs Spike (X)</h2>

  <div id="ui">
    <div id="status">Ruch: <strong id="turn">X (Spike)</strong></div>
    <div>
      <button id="resetBtn">Reset</button>
    </div>
  </div>

  <x3d width="900px" height="900px" style="display:block; margin:0 auto;">
    <scene>
      <!-- plansza -->
      <transform translation="0 1 0">
        <shape>
          <appearance>
            <material diffuseColor="0.5 0.5 0.5"></material>
          </appearance>
          <box size="5 5 0.1"></box>
        </shape>
      </transform>

      <!-- komórki -->
      <transform id="cell0" translation="-1.5 2.5 0.2">
        <shape>
          <appearance>
            <imageTexture url=""></imageTexture>
            <material diffuseColor="1 1 1"></material>
          </appearance>
          <box size="1.1 1.1 0.1"></box>
        </shape>
        <TouchSensor DEF="sensor0"></TouchSensor>
      </transform>

      <transform id="cell1" translation="0 2.5 0.2">
        <shape>
          <appearance>
            <imageTexture url=""></imageTexture>
            <material diffuseColor="1 1 1"></material>
          </appearance>
          <box size="1.1 1.1 0.1"></box>
        </shape>
        <TouchSensor DEF="sensor1"></TouchSensor>
      </transform>

      <transform id="cell2" translation="1.5 2.5 0.2">
        <shape>
          <appearance>
            <imageTexture url=""></imageTexture>
            <material diffuseColor="1 1 1"></material>
          </appearance>
          <box size="1.1 1.1 0.1"></box>
        </shape>
        <TouchSensor DEF="sensor2"></TouchSensor>
      </transform>

      <transform id="cell3" translation="-1.5 1 0.2">
        <shape>
          <appearance>
            <imageTexture url=""></imageTexture>
            <material diffuseColor="1 1 1"></material>
          </appearance>
          <box size="1.1 1.1 0.1"></box>
        </shape>
        <TouchSensor DEF="sensor3"></TouchSensor>
      </transform>

      <transform id="cell4" translation="0 1 0.2">
        <shape>
          <appearance>
            <imageTexture url=""></imageTexture>
            <material diffuseColor="1 1 1"></material>
          </appearance>
          <box size="1.1 1.1 0.1"></box>
        </shape>
        <TouchSensor DEF="sensor4"></TouchSensor>
      </transform>

      <transform id="cell5" translation="1.5 1 0.2">
        <shape>
          <appearance>
            <imageTexture url=""></imageTexture>
            <material diffuseColor="1 1 1"></material>
          </appearance>
          <box size="1.1 1.1 0.1"></box>
        </shape>
        <TouchSensor DEF="sensor5"></TouchSensor>
      </transform>

      <transform id="cell6" translation="-1.5 -0.5 0.2">
        <shape>
          <appearance>
            <imageTexture url=""></imageTexture>
            <material diffuseColor="1 1 1"></material>
          </appearance>
          <box size="1.1 1.1 0.1"></box>
        </shape>
        <TouchSensor DEF="sensor6"></TouchSensor>
      </transform>

      <transform id="cell7" translation="0 -0.5 0.2">
        <shape>
          <appearance>
            <imageTexture url=""></imageTexture>
            <material diffuseColor="1 1 1"></material>
          </appearance>
          <box size="1.1 1.1 0.1"></box>
        </shape>
        <TouchSensor DEF="sensor7"></TouchSensor>
      </transform>

      <transform id="cell8" translation="1.5 -0.5 0.2">
        <shape>
          <appearance>
            <imageTexture url=""></imageTexture>
            <material diffuseColor="1 1 1"></material>
          </appearance>
          <box size="1.1 1.1 0.1"></box>
        </shape>
        <TouchSensor DEF="sensor8"></TouchSensor>
      </transform>
    </scene>
  </x3d>

  <script>
    const IMG_X = 'spike.jpg';
    const IMG_O = 'twilight.jpg';

    let board = ['', '', '', '', '', '', '', '', ''];
    let current = 'X';
    let gameOver = false;
    const combos = [
      [0,1,2],[3,4,5],[6,7,8],
      [0,3,6],[1,4,7],[2,5,8],
      [0,4,8],[2,4,6]
    ];

    const statusEl = document.getElementById('turn');
    const resetBtn = document.getElementById('resetBtn');

    function updateStatus() {
      statusEl.textContent = current === 'X' ? 'X (Spike)' : 'O (Twilight)';
    }

    function getImageTextureElem(cellEl) {
      return cellEl.querySelector('ImageTexture') || cellEl.querySelector('imageTexture');
    }

    function setCellImage(index, player) {
      const cell = document.getElementById('cell' + index);
      const img = getImageTextureElem(cell);
      if (!img) return;
      if (player === 'X') img.setAttribute('url', IMG_X);
      else if (player === 'O') img.setAttribute('url', IMG_O);
      else img.setAttribute('url', '');
    }

    function setCellColor(index, r,g,b) {
      const cell = document.getElementById('cell' + index);
      const mat = cell.querySelector('Material') || cell.querySelector('material');
      if (!mat) return;
      mat.setAttribute('diffuseColor', `${r} ${g} ${b}`);
    }

    function checkWin(p) {
      for (const c of combos) {
        if (board[c[0]]===p && board[c[1]]===p && board[c[2]]===p) return c;
      }
      return null;
    }

    function isDraw() {
      return board.every(x => x==='X' || x==='O');
    }

    function makeMove(index) {
      if (gameOver || board[index]!=='') return;
      board[index] = current;
      setCellImage(index, current);

      const win = checkWin(current);
      if (win) {
        win.forEach(i => setCellColor(i, 0.6, 1, 0.6));
        gameOver = true;
        setTimeout(()=>alert(current + ' wygrał!'),10);
        return;
      }

      if (isDraw()) {
        gameOver = true;
        setTimeout(()=>alert('Remis!'),10);
        return;
      }

      current = current==='X' ? 'O' : 'X';
      updateStatus();
    }

    function resetGame() {
      board = ['', '', '', '', '', '', '', '', ''];
      current = 'X';
      gameOver = false;
      for (let i=0;i<9;i++) {
        setCellImage(i,'');
        setCellColor(i,1,1,1);
      }
      updateStatus();
    }

    // ✅ PODŁĄCZENIE KLIKNIĘĆ — poprawna metoda X3DOM
    for (let i=0;i<9;i++) {
      const sensor = document.querySelector(`#cell${i} TouchSensor`);
      if (sensor) {
        sensor.addEventListener('touchstart', () => makeMove(i));
      }
    }

    resetBtn.addEventListener('click', resetGame);
    updateStatus();
  </script>
</body>
</html>

        let lightRed = document.getElementById('lightRed');
        let lightYellow = document.getElementById('lightYellow');
        let lightGreen = document.getElementById('lightGreen');
        let currentState = 0;

        setInterval(function () {
            let phase = currentState % 4;
            if (phase === 0) {
                lightRed.setAttribute('diffuseColor', `1 0 0`);
                lightYellow.setAttribute('diffuseColor', `0.5 0.5 0.5`);
                lightGreen.setAttribute('diffuseColor', `0.5 0.5 0.5`);
            } else if (phase === 1) {
                lightRed.setAttribute('diffuseColor', `0.5 0.5 0.5`);
                lightYellow.setAttribute('diffuseColor', `1 1 0`);
                lightGreen.setAttribute('diffuseColor', `0.5 0.5 0.5`);
            } else if (phase === 2) {
                lightRed.setAttribute('diffuseColor', `0.5 0.5 0.5`);
                lightYellow.setAttribute('diffuseColor', `0.5 0.5 0.5`);
                lightGreen.setAttribute('diffuseColor', `0 1 0`);
            } else if (phase === 3) {
                lightRed.setAttribute('diffuseColor', `0.5 0.5 0.5`);
                lightYellow.setAttribute('diffuseColor', `1 1 0`);
                lightGreen.setAttribute('diffuseColor', `0.5 0.5 0.5`);
            }

            currentState += 1;
        }, 1000);
    </script>
</body>

</html>